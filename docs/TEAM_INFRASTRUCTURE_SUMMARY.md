# 인프라 현황 및 개선 제안

**작성일**: 2025-11-17
**대상**: 팀 전체
**목적**: 현재 인프라 구조 공유 및 실행 가능한 개선 사항 논의

---

## 📋 TL;DR

- ✅ 현재 인프라는 잘 구성되어 있음 (CI/CD, 자동 배포, 롤백, 백업)
- ⚡ **제안**: 모니터링 강화 (비용: ~$5/월, 작업: 1-2일)
- 🔒 SSH 보안 강화 (비용: $0, 작업: 30분)
- 📊 대시보드 구성 (비용: $0, 작업: 2시간)

---

## 1️⃣ 현재 인프라 구조

```
┌─────────────────────────────────────────────────────────┐
│                    GitHub                                │
│  ┌──────────────┐         ┌──────────────┐             │
│  │ Code Push    │────────▶│ Actions      │             │
│  │ (main)       │         │ (CI/CD)      │             │
│  └──────────────┘         └──────┬───────┘             │
│                                   │                      │
│                           ┌───────▼────────┐            │
│                           │ GHCR           │            │
│                           │ (이미지 저장)   │            │
│                           └───────┬────────┘            │
└───────────────────────────────────┼──────────────────────┘
                                    │ Pull Image
                            ┌───────▼────────┐
                            │   AWS EC2      │
                            │                │
                            │ ┌────────────┐ │
                            │ │  Docker    │ │
                            │ │ Container  │ │
                            │ └─────┬──────┘ │
                            │       │        │
                            │ ┌─────▼──────┐ │
                            │ │ H2 DB      │ │
                            │ │ (Volume)   │ │
                            │ └────────────┘ │
                            └───────┬────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
            ┌───────▼──────┐ ┌─────▼─────┐ ┌──────▼──────┐
            │ CloudWatch   │ │    S3     │ │   Slack     │
            │ (로그)        │ │ (백업)    │ │  (알림)     │
            └──────────────┘ └───────────┘ └─────────────┘
```

### 주요 컴포넌트

| 컴포넌트 | 역할 | 비용 |
|---------|------|------|
| **GitHub Actions** | 자동 빌드/배포 | $0 |
| **GHCR** | Docker 이미지 저장소 | $0 |
| **EC2 (t2.micro)** | 애플리케이션 서버 | $0 (프리티어) |
| **CloudWatch Logs** | 로그 수집/저장 | $0 (프리티어) |
| **S3** | 데이터베이스 백업 | $0 (프리티어) |
| **Docker Volume** | 데이터 영구 저장 | $0 |
| **Slack** | 배포 알림 | $0 |
| **총계** | | **$0/월** |

---

## 2️⃣ 잘 구축된 부분 👏

### ✅ 완전 자동화된 배포
```
코드 Push → 자동 빌드 → 자동 배포 → 헬스체크 → Slack 알림
```
- 개발자는 코드만 푸시하면 됨
- 배포 실패 시 자동 롤백

### ✅ 원클릭 롤백 시스템
- GitHub Actions에서 버튼 하나로 이전 버전 복구
- 데이터베이스도 자동 복원
- 안전 장치(confirmation) 포함

### ✅ 백업 전략
- 배포마다 자동 백업 (로컬 + S3)
- 7일간 로컬 보관
- S3에 장기 보관

### ✅ 보안
- Secrets 관리 (GitHub Secrets)
- IAM Role 사용 (credentials 노출 없음)
- Private container registry

### ✅ 모니터링 (기본)
- CloudWatch Logs
- Health check
- Slack 알림

**종합**: 초기 스타트업/MVP로는 매우 잘 구성됨

---

## 3️⃣ 개선 제안 (우선순위순)

### 🥇 1순위: 모니터링 강화 (추천!)

#### 현재 상황
```
알 수 있는 것:
✅ 서비스 살아있는지
✅ 에러 로그

알 수 없는 것:
❌ CPU/메모리 사용률
❌ 응답 시간 (느려지고 있는지)
❌ 에러율 추이
❌ 언제 서버가 죽을지 (사전 경고 없음)
```

#### 문제 시나리오
```
현재:
  사용자 "너네 서비스 왜 느려?"
  → 그제서야 문제 인지 😱

개선 후:
  Slack "⚠️ CPU 80% 도달!"
  → 사용자가 느끼기 전에 조치 🎯
```

#### 개선 내용

**1단계: 메트릭 수집 (1-2일)**
```bash
# CloudWatch Agent 설치
- CPU 사용률
- 메모리 사용률
- 디스크 사용률
- 네트워크 트래픽
```

**2단계: 알람 설정 (2시간)**
```yaml
알람 목록:
- ⚠️ CPU > 80% (5분 지속)
- ⚠️ 메모리 > 85%
- ⚠️ 디스크 > 80%
- 🚨 Health check 실패 (2회 연속)
- 🚨 5xx 에러율 > 5%

알림 채널: Slack
```

**3단계: 대시보드 구성 (2시간)**
```
CloudWatch Dashboard:
- 실시간 CPU/메모리 그래프
- 응답 시간 추이
- 에러율 추이
- 트래픽 패턴
```

#### 비용 및 작업량
```
비용: ~$5/월 (프리티어 초과분)
작업 시간: 1-2일
난이도: ⭐⭐☆☆☆ (중하)
효과: ⭐⭐⭐⭐⭐ (매우 높음)
```

#### 기대 효과
- ✅ 문제를 사용자보다 먼저 인지
- ✅ 장애 예방 (사전 경고)
- ✅ 용량 계획 가능 (언제 서버 증설할지)
- ✅ 성능 개선 포인트 파악

---

### 🥈 2순위: 보안 강화

#### SSH 접근 제한 (즉시 가능)

**현재 (추정)**:
```yaml
Security Group:
- SSH (22): 0.0.0.0/0  # 전 세계 누구나 접근 가능 ⚠️
```

**개선**:
```yaml
옵션 1 - IP 제한:
- SSH (22): [우리 회사 IP]/32

옵션 2 - Session Manager:
- SSH 포트 완전 차단
- AWS Console로 접속
```

**비용**: $0
**작업 시간**: 30분
**효과**: 무차별 대입 공격(brute force) 차단

---

### 🥉 3순위: 대시보드 공유

#### CloudWatch Dashboard 생성

**목적**: 팀 전체가 시스템 상태 확인 가능

**내용**:
```
대시보드 위젯:
1. 서비스 상태 (UP/DOWN)
2. CPU/메모리 사용률 (실시간)
3. 응답 시간 (평균, P95, P99)
4. 에러율 추이
5. 배포 이력
6. 백업 상태
```

**공유**:
```
- Public URL 생성
- TV 모니터에 띄워두기 (선택)
- 주간 리포트 자동 생성 (선택)
```

**비용**: $0
**작업 시간**: 2시간
**효과**: 투명성 향상, 팀 신뢰도 상승

---

## 4️⃣ 실행 계획

### 이번 주
```
[ ] SSH Security Group IP 제한
    담당: [OOO]
    완료 기한: 금요일
    비용: $0
```

### 다음 주
```
[ ] CloudWatch Agent 설치
    담당: [OOO]
    완료 기한: 다음주 수요일
    비용: ~$5/월

[ ] CloudWatch Alarms 설정
    담당: [OOO]
    완료 기한: 다음주 금요일
    비용: 포함
```

### 다다음 주
```
[ ] CloudWatch Dashboard 구성
    담당: [OOO]
    완료 기한: 다다음주 수요일
    비용: $0

[ ] 팀원 교육 (대시보드 보는 법)
    담당: [OOO]
    완료 기한: 다다음주 금요일
```

---

## 5️⃣ 비용 요약

| 항목 | 현재 | 개선 후 | 증가 |
|------|------|---------|------|
| EC2 | $0 | $0 | - |
| CloudWatch (기본) | $0 | $0 | - |
| CloudWatch (메트릭) | - | ~$3/월 | +$3 |
| CloudWatch (알람) | - | ~$2/월 | +$2 |
| S3 | $0 | $0 | - |
| **총계** | **$0/월** | **~$5/월** | **+$5** |

**프리티어 종료 후 (13개월 차)**: ~$25/월

---

## 6️⃣ 향후 고려 사항

### 사용자 증가 시 검토할 사항

**현재 한계**:
- 단일 서버 (EC2 1대)
- H2 파일 기반 DB
- 예상 수용 인원: ~50-100명

**사용자 500명+ 도달 시 검토**:
1. **Auto Scaling** (서버 자동 증설)
   - 비용: +$30/월
   - 가용성 99.9% 달성

2. **데이터베이스 업그레이드**
   - RDS PostgreSQL
   - 비용: +$15/월
   - 안정성 및 동시 접속 개선

3. **Load Balancer**
   - 무중단 배포 가능
   - 비용: +$20/월

**총 추가 비용**: ~$65/월

**시기**: 사용자 피드백 보고 결정 (지금은 불필요)

---

## 7️⃣ Q&A

### Q1: 왜 지금 모니터링을 강화해야 하나요?
**A**:
- 현재는 문제가 생겨야 알 수 있음
- 사용자보다 먼저 문제를 발견해야 신뢰도 상승
- 비용 대비 효과가 가장 큽니다 ($5로 큰 개선)

### Q2: H2 DB를 RDS로 바꾸지 않아도 되나요?
**A**:
- 현재 사용자 규모에서는 H2도 충분합니다
- 백업 시스템이 잘 되어 있어서 위험도는 낮음
- 사용자 증가 추이를 보고 판단해도 늦지 않습니다
- 단, 동시 접속자가 많아지면 (100명+) 검토 필요

### Q3: 프리티어 끝나면 비용이 얼마나 나오나요?
**A**:
```
현재 구조 유지: ~$20/월
모니터링 추가: ~$25/월

참고: Netflix 1달 구독료 정도
```

### Q4: 작업 중 서비스 중단되나요?
**A**:
- CloudWatch Agent 설치: 서비스 중단 없음 (백그라운드 설치)
- 알람 설정: 웹 콘솔에서 설정 (서비스 영향 없음)
- SSH 보안 설정: 순간 SSH 재연결 필요 (서비스는 정상)

### Q5: 혹시 잘못되면 롤백 가능한가요?
**A**:
- CloudWatch Agent: 언제든 제거 가능
- 알람: 언제든 비활성화 가능
- 비파괴적 작업이라 걱정 없습니다

---

## ✅ 결론

### 현재 상태
- 🟢 **잘 구성됨**: CI/CD, 배포, 롤백, 백업, 보안
- 🟡 **개선 여지**: 모니터링, 네트워크 보안
- 💰 **비용 효율적**: 현재 $0/월

### 제안 요약
```
1순위: 모니터링 강화
  → 비용: $5/월
  → 시간: 1-2일
  → 효과: 매우 큼
  → 추천도: ⭐⭐⭐⭐⭐

2순위: SSH 보안
  → 비용: $0
  → 시간: 30분
  → 효과: 중간
  → 추천도: ⭐⭐⭐⭐☆

3순위: 대시보드
  → 비용: $0
  → 시간: 2시간
  → 효과: 중간
  → 추천도: ⭐⭐⭐☆☆
```

### 다음 단계
1. 팀 동의 구하기 (오늘)
2. 담당자 배정 (이번 주)
3. 단계별 실행 (2-3주)

**총 투자**: $5/월 + 2일 작업
**기대 효과**: 운영 안정성 대폭 향상 🚀

---

**질문이나 의견 있으시면 언제든 말씀해주세요!**
